# .理解内核消息 dmesg

# 2024-05-01 Lighthawk

## 总结的起因是[初学内核驱动加载](../Driver/初学内核驱动编译和加载.md)，用dmesg查看

## 参考资料

> [Linux内核日志查看之dmesg命令简介_dmesg日志怎么看-CSDN博客](https://blog.csdn.net/guotianqing/article/details/108401743) 【博主原创 · 转载需声明】
>
> [Linux dmesg命令教程：深入理解内核消息(附案例详解和注意事项)_centos安装dmesg命令-CSDN博客](https://blog.csdn.net/u012964600/article/details/136396941)

## 资料整理如下

> dmesg is used to examine or control the kernel ring [buffer](https://so.csdn.net/so/search?q=buffer&spm=1001.2101.3001.7020). The default action is to display all messages from the kernel ring buffer.

Linux内核启动时会加载硬件驱动，在有新硬件时也会加载驱动，如果想要**查看内核的活动**，可以使用dmesg命令。

Linux内核日志存储在一个ring-buffer中，它的**大小是固定的**，当队列满时，新的消息会覆盖掉最旧的消息。

实际上，在boot阶段，所有的应用还没有启动，syslogd也未启动，这时**内核日志**是非常重要的信息。

除了设备初始化日志、内核模块日志，它还会**包含一些应用崩溃的相关信息**记录，了解dmesg的使用对于调试程序相当重要。



### 常用参数和作用

```shell
1
dmesg | grep USB   # 查看USB消息
2
dmesg -l err       # 显示硬件错误
3
dmesg --follow     # 实时监视新消息
4
dmesg | tail -10   # 输出最后10行，也可以跟管道和其他命令：more，less，grep 等等
```



### 日志级别

```shell
1
emerg: System is unusable.
2
alert: Action must be taken immediately.
3
crit: Critical conditions.
4
err: Error conditions.
5
warn: Warning conditions.
6
notice: Normal but significant condition.
7
info: Informational.
8
debug: Debug-level messages.
```

使用`dmesg -l info`仅输出info级别的日志，这不包括更高级别的日志。

'dmesg -l debug,notice’同时输出多种级别的日志。



### 用户组

```shell
1
kern: Kernel messages.
2
user: User-level messages.
3
mail: Mail system.
4
daemon: System daemons.
5
auth: Security/authorization messages.
6
syslog: Internal syslogd messages.
7
lpr: Line printer subsystem.
8
news: Network news subsystem.
```

使用`-f(facility)'参数过滤组。

使用 `-x(decode)` 参数可以输出包括组和日志级别的信息。



### 清除旧内容

**对于服务器，本操作请谨慎使用，清除后不会再恢复。**

对于嵌入式设备的调试，它会比较清楚地展现当前的log信息。

dmesg -c

显示并清除当前的日志内容。

下次再dmesg时就没有以前的日志了。

